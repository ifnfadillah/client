'use client'
import { Button } from "@/components/ui/button"
import { useState, useEffect } from "react"
import dynamic from 'next/dynamic'
import { LatLngTuple } from "leaflet"

// Tambahkan interface untuk data kampung
interface KampungData {
  name: string;
  lat: number;
  lng: number;
  geofence: LatLngTuple[];
  color: string;
}

interface KampungLocations {
  [key: string]: KampungData;
}

// Data Kampung (Lat, Lng, dan Geofence)
const kampungLocations: KampungLocations = {
  ketawanggede: { 
    name: "Kampung Ketawanggede", 
    lat: -7.9495, 
    lng: 112.6135,
    geofence: [
      [-7.95153495135576, 112.60828769787466], [-7.95412760976159, 112.61056221106307], [-7.954616387788669, 112.61127031422551],
      [-7.955126416413132, 112.61133468724027], [-7.955848955878391, 112.61184967135841], [-7.956741502871497, 112.61262214753562], [-7.957187775639298, 112.61371648878664], [-7.9568052561537845, 112.61448896496384], [-7.956847758336474, 112.6155189332001], [-7.956125220631539, 112.61566913690122], [-7.955126416413132, 112.61652744376478], [-7.955105165233107, 112.61618412101936],
      [-7.952682523491524, 112.61682785116703], [-7.951492448622414, 112.61558330621489], [-7.950344873157283, 112.61659181677955], [-7.949239797453295, 112.61545456018534], [-7.948814767543867, 112.61528289881264], [-7.94845349177471, 112.61485374538086], [-7.947475920451728, 112.61470354167973], [-7.9467746178508065, 112.61397398084571],
      [-7.947412165719339, 112.61311567398215], [-7.944840716591977, 112.61142051792663], [-7.9450957370596775, 112.61064804174943], [-7.9462220755636945, 112.60959661584157], [-7.9459245524856215, 112.60903871638027], [-7.947093391908872, 112.6088026819928], [-7.946880875897667, 112.60818040951672],
      [-7.947497172026982, 112.60828769787466], [-7.949983598735371, 112.60833061321783], [-7.950876158493915, 112.60863102062008]
    ],
    color: "red"
  },
  sumbersari: { 
    name: "Kampung Sumbersari", 
    lat: -7.9568, 
    lng: 112.6175,
    geofence: [
      [-7.961875, 112.608686], [-7.962264854960345, 112.61145144625904], 
      [-7.962689870926107, 112.61243849915212], [-7.963964916177313, 112.61284619491231], [-7.964063093226102, 112.61422093155969], [-7.966738956634212, 112.61912149417684], [-7.963667405973731, 112.62155800957737],
      [-7.95995939711737, 112.62143623591429],[-7.956018003511796, 112.61573492651065], [-7.957064963806813, 112.61488921692538], [-7.957204558310778, 112.6136911283462], [-7.955597593979549, 112.61159874343635], [-7.954652848935729, 112.61096279354918], [-7.951293738245696, 112.60820701091201], [-7.953865559836342, 112.60807452136216], [-7.958143145735075, 112.60619316975406]
    ],
    color: "green"
  },
  keramikdinoyo: { 
    name: "Kampung Keramik Dinoyo", 
    lat: -7.941539317687739, 
    lng: 112.61167996767391,
    geofence: [
      [-7.944180292865072, 112.61131467903881], [-7.947309143135758, 112.61315753417955], [-7.94681374343202, 112.61410528825193], [-7.945040729066814, 112.61336814619564], [-7.944441031298444, 112.61381569672982], [-7.944258514412463, 112.61368406421977], [-7.943867406526452, 112.6125520246333], [-7.942694080633212, 112.61249937162928],
      [-7.941807565512734, 112.61286794265745], [-7.941364307234892, 112.61265733064134], [-7.940712455957315, 112.61234141261721], [-7.940321344694228, 112.61186753558103], [-7.939878084812572, 112.61205182109444], [-7.939486972755111, 112.61128835253614], [-7.938391857013373, 112.61131467903813], [-7.937635703964434, 112.61081447549994],
      [-7.9367752522507065, 112.61005100694163], [-7.936514508951467, 112.60923488537931], [-7.935523682905709, 112.60902427336322], [-7.9329683836606, 112.6079975397848], [-7.933437725528967, 112.6072603977285], [-7.933385576458937, 112.60641794966416], [-7.934454631072371, 112.60686550019834], [-7.936269941586185, 112.60540227332994], [-7.9358302508354015, 112.60523111478356],
      [-7.93631330356741, 112.60470359887107], [-7.942178689282357, 112.60695740786717], [-7.944133854829574, 112.60631367771951], [-7.946660708132345, 112.60615307883559], [-7.9483946329362976, 112.60428449997632], [-7.9499284833779615, 112.6035774701775], [-7.953346281740914, 112.60292094248763], [-7.953946477525612, 112.60324078930138],
      [-7.954096526334539, 112.60377947867191], [-7.954580016567554, 112.60425083187114], [-7.954429967935556, 112.60564805742597], [-7.954246575088544, 112.6079206532079], [-7.95384644495584, 112.60795432129353],
      [-7.951679066619147, 112.60790381916506], [-7.950828784297717, 112.60847617662124], [-7.950361961881632, 112.6084425085356], [-7.947127534839075, 112.60805532555052], [-7.946627363432922, 112.60808899363619], 
      [-7.947044172980375, 112.60867818513519], [-7.945943794858822, 112.60908220216311], [-7.946233960432102, 112.60970865254907], [-7.945340410141404, 112.6101096357247], [-7.945251055005355, 112.61035523791979], [-7.945300696749998, 112.61051563119003], [-7.945134396881786, 112.61068103675001], [-7.945208859517675, 112.61087400990327], [-7.944839028293083, 112.61137523887282]
    ],
    color: "blue"
  },
  cempluk: { 
    name: "Kampung Cempluk", 
    lat: -7.967875013194411, 
    lng:112.59648992534572,
    geofence: [
      [-7.974762450279638, 112.598996897497], [-7.972127421894003, 112.5998122890174], 
      [-7.972552427620389, 112.60075642656732], [-7.971787416995011, 112.60187222548994], [-7.971617414439565, 112.60285927838301], [-7.970384893800182, 112.6030738550989], [-7.967282325413405, 112.60225846357854],
      [-7.966389801385048, 112.60101391862636], [-7.965183225296078, 112.60045836028219], [-7.96416226129372, 112.59886367376106], [-7.96424202419806, 112.59884756581641], [-7.961290786392297, 112.59543268154896], [-7.96181722496442, 112.59451452870347], [-7.962056515000848, 112.59283930245907], [-7.961944846334586, 112.59237217206399],
      [-7.962088420328482, 112.59169563838839], [-7.961179117517303, 112.58886064012862], [-7.959823135850423, 112.58609007345237], [-7.958749940656315, 112.58307760712555], [-7.958476146519547, 112.58176443697499], [-7.959160631518495, 112.58055493815213], [-7.95604621554127, 112.5745074440378], [-7.958647267876462, 112.57319427388725], [-7.959571321969087, 112.57333250232416],
      [-7.96135097583174, 112.57264136013968], [-7.960906063113345, 112.5720538889797], [-7.963267517522333, 112.57087894726605], [-7.9642600087903155, 112.56991134820777], [-7.963541308457184, 112.5679761500912], [-7.963780875375018, 112.5649351244794],
      [-7.966758338230228, 112.56047725738941], [-7.968674854590615, 112.56206688441377], [-7.974835024959259, 112.56303448347204], [-7.970214905877449, 112.56410575385802], [-7.971891844020586, 112.5670085510329], [-7.970351799044699, 112.56807982141886], [-7.970351799044699, 112.57060249039226], [-7.96792193851913, 112.57288325960108], [-7.967442809388955, 112.57378174444094],
      [-7.96795616200697, 112.57495668615458], [-7.968127279403254, 112.57882708238773], [-7.9665529966594475, 112.5810041802689], [-7.96720324461357, 112.58211000776409], [-7.972199852320177, 112.58815750187841], [-7.9721656291872245, 112.58933244359206], [-7.973021206652037, 112.59074928507027], [-7.9732607680215315, 112.59323739693444], [-7.973528895927211, 112.59584854414152],
      [-7.974943814121891, 112.59936275458901]
    ],
    color: "purple"
  },
}

// Dynamic import untuk KampungMap
const KampungMap = dynamic(() => import('./kampung-map').then(mod => mod.KampungMap), {
  ssr: false,
  loading: () => <div className="h-96 w-full flex items-center justify-center">Loading map...</div>
})

export function KampungSection() {
  const [activeTab, setActiveTab] = useState<string | null>(null) 
  const showAll = activeTab === null 
  const [isMounted, setIsMounted] = useState(false)

  useEffect(() => {
    setIsMounted(true)
  }, [])

  return (
    <section className="mt-10 mx-8">
      <div className="container mx-auto px-4">
        <div className="flex flex-col lg:flex-row justify-center space-x-2 mb-4 space-y-4 lg:space-y-0">
          <h2 className="flex text-center text-xl lg:text-3xl w-fit font-bold text-white bg-amber-500 px-3 py-1 rounded-lg shadow-xl">
            Kampung-Kampung Lingkar Kampus
          </h2>
        </div>
        <p className="text-xs md:text-sm text-center text-gray-600 dark:text-white mb-4">
          Berikut 4 Kampung yang ada di sekitar Kampus Universitas Brawijaya
        </p>
        <div className="flex flex-wrap justify-center gap-4">
          <Button 
            variant="outline" 
            className={`bg-white rounded-2xl dark:bg-black dark:text-white dark:hover:bg-gray-700 hover:bg-blue-200  ${showAll ? " bg-blue-500 dark:bg-blue-500 dark:text-whiteshadow-md text-white" : ""}`} 
            onClick={() => setActiveTab(null)}
          >
            Semua Kampung
          </Button>
          {Object.keys(kampungLocations).map((key) => (
            <Button 
              key={key}
              variant="outline" 
              className={`bg-white dark:bg-black dark:text-white dark:hover:bg-gray-700 dark:outline-2 rounded-2xl hover:bg-blue-200 ${activeTab === key ? " bg-blue-500 dark:bg-blue-500 dark:text-white shadow-md text-white" : ""}`} 
              onClick={() => setActiveTab(key)}
            >
              {kampungLocations[key].name}
            </Button>
          ))}
        </div>
        <div className="mt-8">
          {isMounted && (
            <KampungMap 
              kampungLocations={kampungLocations}
              activeTab={activeTab}
              showAll={showAll}
            />
          )}
        </div>
      </div>
    </section>
  )
}
